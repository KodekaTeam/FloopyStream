<% layout('dashboard/layout') %>

<div class="flex h-screen bg-gray-900 overflow-hidden">
  <%- include('partials/navbar') %> <%- include('partials/sidebar') %>

  <!-- Main Content -->
  <main class="flex-1 overflow-auto lg:ml-20 pt-16">
    <div class="p-4 sm:p-6 lg:p-8">
      <!-- Header -->
      <div class="mb-6 sm:mb-8">
        <h2 class="text-2xl sm:text-3xl font-bold text-white">Dashboard</h2>
        <p class="text-gray-400 mt-1 text-sm sm:text-base">
          Manage your live streams and broadcasts
        </p>
      </div>

      <!-- Stats Cards -->
      <div
        class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-6 sm:mb-8"
      >
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
          <div class="flex items-center justify-between mb-2">
            <p class="text-gray-400 text-sm">Active Streams</p>
            <i class="ti ti-broadcast text-gray-500"></i>
          </div>
          <p class="text-2xl font-bold text-white" id="activeBroadcastCount">
            <%= activeBroadcastCount || 0 %>
          </p>
        </div>

        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
          <div class="flex items-center justify-between mb-2">
            <p class="text-gray-400 text-sm">CPU Usage</p>
            <i class="ti ti-cpu text-gray-500"></i>
          </div>
          <p class="text-2xl font-bold text-white">
            <span id="cpuUsage">0</span>%
          </p>
          <div class="w-full bg-gray-700 rounded-full h-1 mt-3">
            <div
              id="cpuBar"
              class="bg-blue-500 h-1 rounded-full transition-all duration-300"
              style="width: 0%"
            ></div>
          </div>
        </div>

        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
          <div class="flex items-center justify-between mb-2">
            <p class="text-gray-400 text-sm">Memory</p>
            <i class="ti ti-device-sd-card text-gray-500"></i>
          </div>
          <p class="text-2xl font-bold text-white">
            <span id="memoryUsed">0.00</span> GB
          </p>
          <p class="text-sm text-gray-500 mt-1">
            / <span id="memoryTotal">0.00</span> GB
          </p>
        </div>

        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
          <div class="flex items-center justify-between mb-2">
            <p class="text-gray-400 text-sm">Internet Speed</p>
            <i class="ti ti-wifi text-gray-500"></i>
          </div>
          <div class="space-y-1">
            <div class="flex items-center gap-2">
              <i class="ti ti-arrow-up text-green-400 text-sm"></i>
              <!-- <span class="text-sm text-gray-400 block sm:hidden">U</span> -->
              <span class="text-sm text-gray-400 hidden sm:block">Upload</span>
              <span
                class="text-sm font-semibold text-green-400 ml-auto"
                id="uploadSpeed"
              >
                <span class="block sm:hidden">0 Kbps</span>
                <span class="hidden sm:block">0 Mbps</span>
              </span>
            </div>
            <div class="flex items-center gap-2">
              <i class="ti ti-arrow-down text-blue-400 text-sm"></i>
              <!-- <span class="text-sm text-gray-400 block sm:hidden">D</span> -->
              <span class="text-sm text-gray-400 hidden sm:block"
                >Download</span
              >
              <span
                class="text-sm font-semibold text-blue-400 ml-auto"
                id="downloadSpeed"
              >
                <span class="block sm:hidden">0 Kbps</span>
                <span class="hidden sm:block">0 Mbps</span>
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Streaming Status Section -->
      <div class="bg-gray-800 rounded-lg border border-gray-700">
        <div class="p-4 sm:p-6 border-b border-gray-700">
          <div
            class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"
          >
            <div>
              <h3 class="text-lg sm:text-xl font-bold text-white">
                Streaming Status
              </h3>
              <p class="text-xs sm:text-sm text-gray-400 mt-1">
                Manage your live broadcasts
              </p>
            </div>
            <div
              class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3"
            >
              <div class="relative flex-1 sm:flex-initial">
                <input
                  type="text"
                  placeholder="Search..."
                  id="searchInput"
                  class="w-full sm:w-64 bg-gray-700 border border-gray-600 text-white pl-9 pr-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                />
                <i
                  class="ti ti-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
                ></i>
              </div>

              <!-- View Toggle (Tablet & Desktop only, auto card view on mobile) -->
              <div
                class="hidden md:flex items-center gap-1 bg-gray-700 rounded-lg p-1"
              >
                <button
                  id="cardViewBtn"
                  onclick="switchView('card')"
                  class="px-3 py-1.5 rounded transition-colors"
                  title="Card View"
                >
                  <i class="ti ti-layout-grid"></i>
                </button>
                <button
                  id="tableViewBtn"
                  onclick="switchView('table')"
                  class="px-3 py-1.5 rounded transition-colors bg-gray-600"
                  title="Table View"
                >
                  <i class="ti ti-table"></i>
                </button>
              </div>

              <button
                onclick="openNewStreamModal()"
                class="flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors text-sm sm:text-base whitespace-nowrap"
              >
                <i class="ti ti-plus"></i>
                <span>New Stream</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Streams Table - Hidden on Mobile -->
        <div id="tableViewContainer" class="hidden md:block">
          <div class="overflow-x-auto bg-gray-800 rounded-lg">
            <table class="w-full">
              <thead class="bg-gray-900 border-b border-gray-700">
                <tr>
                  <th
                    class="px-6 py-4 text-left text-sm font-semibold text-gray-300"
                  >
                    Stream Name
                  </th>
                  <th
                    class="px-6 py-4 text-left text-sm font-semibold text-gray-300"
                  >
                    Platform
                  </th>
                  <th
                    class="px-6 py-4 text-left text-sm font-semibold text-gray-300"
                  >
                    Start Date
                  </th>
                  <th
                    class="px-6 py-4 text-left text-sm font-semibold text-gray-300"
                  >
                    Schedule
                  </th>
                  <th
                    class="px-6 py-4 text-left text-sm font-semibold text-gray-300"
                  >
                    Duration
                  </th>
                  <th
                    class="px-6 py-4 text-left text-sm font-semibold text-gray-300"
                  >
                    Status
                  </th>
                  <th
                    class="px-6 py-4 text-right text-sm font-semibold text-gray-300"
                  >
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-700" id="streamsTableBody">
                <% if (broadcasts.length === 0) { %>
                <tr>
                  <td colspan="7" class="px-6 py-12 text-center">
                    <div class="flex flex-col items-center gap-3">
                      <i class="ti ti-broadcast text-5xl text-gray-600"></i>
                      <p class="text-gray-400 font-medium">No streams found</p>
                      <p class="text-gray-500">
                        Create your first stream to start broadcasting
                      </p>
                    </div>
                  </td>
                </tr>
                <% } else { %> <% broadcasts.forEach(function(broadcast) { %>
                <tr
                  class="hover:bg-gray-700 transition-colors"
                  data-broadcast-id="<%= broadcast.broadcast_id %>"
                >
                  <td class="px-6 py-4">
                    <div class="flex items-center gap-4">
                      <div
                        class="w-28 h-16 rounded overflow-hidden flex-shrink-0 <%= broadcast.content_type === 'playlist' ? 'bg-gradient-to-br from-purple-600 to-blue-600' : 'bg-gray-700' %>"
                      >
                        <% if (broadcast.thumbnail_path) { %>
                        <img
                          src="/storage/thumbnails/<%= broadcast.thumbnail_path %>"
                          alt="Thumbnail"
                          class="w-full h-full object-cover"
                        />
                        <% } else if (broadcast.content_type === 'playlist') {
                        %>
                        <div
                          class="w-full h-full flex items-center justify-center"
                        >
                          <i class="ti ti-playlist text-3xl text-white"></i>
                        </div>
                        <% } else { %>
                        <div
                          class="w-full h-full flex items-center justify-center"
                        >
                          <i class="ti ti-video text-2xl text-gray-500"></i>
                        </div>
                        <% } %>
                      </div>
                      <div>
                        <p class="text-white font-medium">
                          <%= broadcast.broadcast_name || 'Untitled Broadcast'
                          %>
                        </p>
                        <p class="text-sm text-gray-400">
                          <% if (broadcast.content_type === 'playlist' &&
                          broadcast.playlist_name) { %>
                          <i class="ti ti-playlist text-blue-400"></i> <%=
                          broadcast.playlist_name %> <% if
                          (broadcast.playback_mode === 'shuffle') { %> •
                          <i class="ti ti-arrows-shuffle text-xs"></i> Shuffle
                          <% } %> <% } else if (broadcast.content_title) { %>
                          <i class="ti ti-video"></i> <%=
                          broadcast.content_title %> <% } %>
                        </p>
                        <p class="text-xs text-gray-500">
                          <% if (broadcast.resolution) { %> <%=
                          broadcast.resolution %> • <%= broadcast.bitrate ||
                          'N/A' %> kbps • <%= broadcast.frame_rate || 30 %> FPS
                          <% } else { %> 1920×1080 • 2500 kbps • 30 FPS <% } %>
                        </p>
                      </div>
                    </div>
                  </td>
                  <td class="px-6 py-4">
                    <div class="flex items-center gap-2">
                      <% const platformIcons = { youtube: 'brand-youtube',
                      facebook: 'brand-facebook', twitch: 'brand-twitch',
                      tiktok: 'brand-tiktok', instagram: 'brand-instagram' };
                      const icon =
                      platformIcons[broadcast.platform_name.toLowerCase()] ||
                      'cast'; %>
                      <i class="ti ti-<%= icon %> text-xl text-gray-400"></i>
                      <span class="text-white capitalize"
                        ><%= broadcast.platform_name %></span
                      >
                    </div>
                  </td>
                  <td class="px-6 py-4 text-gray-300">
                    <%= broadcast.created_at ? new
                    Date(broadcast.created_at).toLocaleString() : '--' %>
                  </td>
                  <td class="px-6 py-4 text-gray-300">
                    <%= broadcast.scheduled_time ? new
                    Date(broadcast.scheduled_time).toLocaleString() : '--' %>
                  </td>
                  <td class="px-6 py-4">
                    <% if (broadcast.broadcast_status === 'active') { %>
                    <div class="flex items-center gap-2">
                      <span class="relative flex h-2 w-2">
                        <span
                          class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"
                        ></span>
                        <span
                          class="relative inline-flex rounded-full h-2 w-2 bg-red-500"
                        ></span>
                      </span>
                      <span class="text-red-400 font-medium">Live</span>
                      <span class="text-gray-400">•</span>
                      <span
                        class="text-gray-300 font-mono timer"
                        data-start="<%= broadcast.started_at || broadcast.created_at %>"
                        >00:00:00</span
                      >
                    </div>
                    <% } else { %>
                    <span class="text-gray-300">
                      <%= broadcast.duration_seconds ?
                      Math.floor(broadcast.duration_seconds / 60) + 'm' : '--'
                      %>
                    </span>
                    <% } %>
                  </td>
                  <td class="px-6 py-4">
                    <% const statusConfig = { active: { color: 'bg-green-600',
                    text: 'LIVE', icon: 'point-filled' }, completed: { color:
                    'bg-blue-600', text: 'COMPLETED', icon: 'check' },
                    scheduled: { color: 'bg-yellow-600', text: 'SCHEDULED',
                    icon: 'clock' }, offline: { color: 'bg-gray-600', text:
                    'OFFLINE', icon: 'circle' }, failed: { color: 'bg-red-600',
                    text: 'FAILED', icon: 'x' } }; const config =
                    statusConfig[broadcast.broadcast_status] || { color:
                    'bg-gray-600', text:
                    broadcast.broadcast_status.toUpperCase(), icon: 'circle' };
                    %>
                    <div class="flex items-center gap-2">
                      <span
                        class="px-3 py-1 rounded-full text-xs font-medium text-white <%= config.color %> flex items-center gap-1"
                      >
                        <i class="ti ti-<%= config.icon %>"></i>
                        <%= config.text %>
                      </span>
                    </div>
                  </td>
                  <td class="px-6 py-4">
                    <div class="flex items-center justify-end gap-2">
                      <% if (broadcast.broadcast_status === 'active') { %>
                      <!-- Stop button for ACTIVE streams -->
                      <button
                        onclick="stopBroadcast('<%= broadcast.broadcast_id %>')"
                        class="p-2 text-red-400 hover:bg-gray-600 rounded transition-colors"
                        title="Stop Stream"
                      >
                        <i class="ti ti-player-stop"></i>
                      </button>
                      <% } else { %>
                      <!-- Start button for OFFLINE, SCHEDULED, FAILED, COMPLETED streams -->
                      <button
                        onclick="startBroadcast('<%= broadcast.broadcast_id %>')"
                        class="p-2 text-green-400 hover:bg-gray-600 rounded transition-colors"
                        title="Start Stream"
                      >
                        <i class="ti ti-player-play"></i>
                      </button>
                      <% } %>
                      <!-- <button
                        onclick="openStreamInfoModal('<%= broadcast.broadcast_id %>')"
                        class="p-2 text-cyan-400 hover:bg-gray-600 rounded transition-colors"
                        title="Info"
                      >
                        <i class="ti ti-info-circle"></i>
                      </button> -->
                      <button
                        onclick="openEditStreamModal('<%= broadcast.broadcast_id %>')"
                        class="p-2 text-blue-400 hover:bg-gray-600 rounded transition-colors"
                        title="Edit Stream"
                      >
                        <i class="ti ti-edit"></i>
                      </button>
                      <!-- <button
                        onclick="editBroadcast('<%= broadcast.broadcast_id %>')"
                        class="p-2 text-amber-400 hover:bg-gray-600 rounded transition-colors"
                        title="Configure Broadcast Settings (Platform, Schedule, Content)"
                      >
                        <i class="ti ti-settings"></i>
                      </button> -->
                      <button
                        onclick="deleteBroadcast('<%= broadcast.broadcast_id %>')"
                        class="p-2 text-red-400 hover:bg-gray-600 rounded transition-colors"
                        title="Delete"
                      >
                        <i class="ti ti-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                <% }) %> <% } %>
              </tbody>
            </table>
          </div>

          <!-- Table Pagination -->
          <% if (broadcasts.length > 0) { %>
          <div
            class="mt-6 flex flex-col sm:flex-row items-center justify-center gap-4"
          >
            <!-- Pagination Buttons -->
            <div class="flex items-center gap-2">
              <button
                onclick="changePage('prev')"
                class="p-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                id="tablePrevBtn"
              >
                <i class="ti ti-chevron-left"></i>
              </button>

              <div id="tablePaginationNumbers" class="flex items-center gap-2">
                <!-- Page numbers will be generated by JavaScript -->
              </div>

              <button
                onclick="changePage('next')"
                class="p-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                id="tableNextBtn"
              >
                <i class="ti ti-chevron-right"></i>
              </button>
            </div>

            <!-- Showing Info -->
            <p class="text-sm text-gray-400" id="tableShowingInfo">
              Showing 1-<%= Math.min(broadcasts.length, 10) %> of <%=
              broadcasts.length %> streams
            </p>
          </div>
          <% } %>
        </div>
      </div>

      <!-- Card View - Visible on Mobile, Hidden on Desktop when Table Toggle is Active -->
      <div id="cardViewContainer" class="block md:hidden">
        <div
          id="cardGrid"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pt-6"
        >
          <% if (broadcasts.length === 0) { %>
          <div class="col-span-full bg-gray-800 rounded-lg p-12 text-center">
            <i class="ti ti-broadcast text-5xl text-gray-600 mb-4"></i>
            <p class="text-gray-400 font-medium mb-2">No streams found</p>
            <p class="text-gray-500 mb-6">
              Create your first stream to start broadcasting
            </p>
            <button
              onclick="openNewStreamModal()"
              class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition"
            >
              <i class="ti ti-plus"></i>
              <span>New Stream</span>
            </button>
          </div>
          <% } else { %> <% broadcasts.forEach(function(broadcast) { %>
          <div
            class="bg-gray-800 rounded-lg overflow-hidden group hover:ring-2 hover:ring-blue-500 transition-all"
            data-broadcast-id="<%= broadcast.broadcast_id %>"
          >
            <!-- Thumbnail with overlay -->
            <div
              class="relative w-full aspect-video overflow-hidden <%= broadcast.content_type === 'playlist' ? 'bg-gradient-to-br from-purple-600 to-blue-600' : 'bg-gray-900' %>"
            >
              <% if (broadcast.thumbnail_path) { %>
              <img
                src="/storage/thumbnails/<%= broadcast.thumbnail_path %>"
                alt="<%= broadcast.broadcast_name || 'Untitled' %>"
                class="w-full h-full object-cover"
              />
              <% } else if (broadcast.content_type === 'playlist') { %>
              <div class="w-full h-full flex items-center justify-center">
                <i class="ti ti-playlist text-6xl text-white opacity-90"></i>
              </div>
              <% } else { %>
              <div class="w-full h-full flex items-center justify-center">
                <i class="ti ti-video text-5xl text-gray-600"></i>
              </div>
              <% } %>

              <!-- Live duration timer (shows when broadcast is active) -->
              <div class="absolute top-2 left-2">
                <% if (broadcast.broadcast_status === 'active') { %>
                <span
                  class="flex items-center gap-2 bg-black/70 backdrop-blur-sm text-white px-2.5 py-1 rounded-full text-xs font-mono timer"
                  data-start="<%= broadcast.started_at || broadcast.created_at %>"
                >
                  <!-- <i class="ti ti-clock text-sm text-gray-200"></i> -->
                  <span>00:00:00</span>
                </span>
                <% } %>
              </div>
              <!-- Status Badge Overlay -->
              <div class="absolute top-2 right-2">
                <% if (broadcast.broadcast_status === 'active') { %>
                <span
                  class="flex items-center gap-1.5 bg-red-600/90 backdrop-blur-sm text-white px-2.5 py-1 rounded-full text-xs font-medium"
                >
                  <span
                    class="w-2 h-2 bg-white rounded-full animate-pulse"
                  ></span>
                  LIVE NOW
                </span>
                <% } else if (broadcast.broadcast_status === 'scheduled') { %>
                <span
                  class="bg-yellow-600/90 backdrop-blur-sm text-white px-2.5 py-1 rounded-full text-xs font-medium"
                >
                  SCHEDULED
                </span>
                <% } else if (broadcast.broadcast_status === 'completed') { %>
                <span
                  class="bg-blue-600/90 backdrop-blur-sm text-white px-2.5 py-1 rounded-full text-xs font-medium"
                >
                  COMPLETED
                </span>
                <% } else if (broadcast.broadcast_status === 'offline') { %>
                <span
                  class="bg-gray-600/90 backdrop-blur-sm text-white px-2.5 py-1 rounded-full text-xs font-medium"
                >
                  OFFLINE
                </span>
                <% } else { %>
                <span
                  class="bg-gray-600/90 backdrop-blur-sm text-white px-2.5 py-1 rounded-full text-xs font-medium"
                >
                  <%= broadcast.broadcast_status.toUpperCase() %>
                </span>
                <% } %>
              </div>

              <!-- Hover Overlay with Quick Actions -->
              <div
                class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2"
              >
                <% if (broadcast.broadcast_status === 'active') { %>
                <!-- Stop button for ACTIVE streams -->
                <button
                  onclick="stopBroadcast('<%= broadcast.broadcast_id %>')"
                  class="w-10 h-10 flex items-center justify-center bg-red-600 hover:bg-red-700 rounded-full transition-colors"
                  title="Stop Stream"
                >
                  <i class="ti ti-player-stop text-white"></i>
                </button>
                <% } else { %>
                <!-- Start button for OFFLINE, SCHEDULED, FAILED, COMPLETED streams -->
                <button
                  onclick="startBroadcast('<%= broadcast.broadcast_id %>')"
                  class="w-10 h-10 flex items-center justify-center bg-green-600 hover:bg-green-700 rounded-full transition-colors"
                  title="Start Stream"
                >
                  <i class="ti ti-player-play text-white"></i>
                </button>
                <% } %>
                <!-- <button
                  onclick="openStreamInfoModal('<%= broadcast.broadcast_id %>')"
                  class="w-10 h-10 flex items-center justify-center bg-cyan-600 hover:bg-cyan-700 rounded-full transition-colors"
                  title="Info"
                >
                  <i class="ti ti-info-circle text-white"></i>
                </button> -->
                <button
                  onclick="openEditStreamModal('<%= broadcast.broadcast_id %>')"
                  class="w-10 h-10 flex items-center justify-center bg-blue-600 hover:bg-blue-700 rounded-full transition-colors"
                  title="Edit"
                >
                  <i class="ti ti-edit text-white"></i>
                </button>
                <button
                  onclick="deleteBroadcast('<%= broadcast.broadcast_id %>')"
                  class="w-10 h-10 flex items-center justify-center bg-gray-700 hover:bg-gray-600 rounded-full transition-colors"
                  title="Delete"
                >
                  <i class="ti ti-trash text-red-400"></i>
                </button>
              </div>
            </div>

            <!-- Card Content -->
            <div class="p-4">
              <h3
                class="font-semibold text-white mb-1 truncate"
                title="<%= broadcast.broadcast_name || broadcast.stream_title || 'Untitled Broadcast' %>"
              >
                <%= broadcast.broadcast_name || broadcast.stream_title ||
                'Untitled Broadcast' %>
              </h3>

              <!-- Content Info -->
              <% if (broadcast.content_type === 'playlist' &&
              broadcast.playlist_name) { %>
              <div class="flex items-center gap-1.5 text-xs text-blue-400 mb-2">
                <i class="ti ti-playlist"></i>
                <span><%= broadcast.playlist_name %></span>
                <% if (broadcast.playback_mode === 'shuffle') { %>
                <i class="ti ti-arrows-shuffle text-xs"></i>
                <% } %>
              </div>
              <% } else if (broadcast.content_title) { %>
              <div class="flex items-center gap-1.5 text-xs text-gray-400 mb-2">
                <i class="ti ti-video"></i>
                <span class="truncate"><%= broadcast.content_title %></span>
              </div>
              <% } %>

              <div class="flex items-center gap-2 text-sm text-gray-400 mb-3">
                <% const platformIcons = { youtube: 'brand-youtube', facebook:
                'brand-facebook', twitch: 'brand-twitch', tiktok:
                'brand-tiktok', instagram: 'brand-instagram', custom: 'cast' };
                const platformIcon =
                platformIcons[broadcast.platform_name?.toLowerCase()] || 'cast';
                %>
                <i class="ti ti-<%= platformIcon %>"></i>
                <span class="capitalize"
                  ><%= broadcast.platform_name || 'Custom' %></span
                >
                <% if (broadcast.resolution || broadcast.bitrate) { %>
                <span>•</span>
                <span> <%= broadcast.resolution || '1920×1080' %> </span>
                <% } %>
              </div>

              <div
                class="flex items-center justify-between text-xs text-gray-500"
              >
                <div class="flex items-center gap-1">
                  <i class="ti ti-clock"></i>
                  <span>
                    <%= broadcast.created_at ? new
                    Date(broadcast.created_at).toLocaleDateString() : '--' %>
                  </span>
                </div>
                <% if (broadcast.duration_seconds) { %>
                <div class="flex items-center gap-1">
                  <i class="ti ti-video"></i>
                  <span
                    ><%= Math.floor(broadcast.duration_seconds / 60) %>m</span
                  >
                </div>
                <% } %>
              </div>
            </div>
          </div>
          <% }) %> <% } %>
        </div>

        <!-- Card Pagination -->
        <% if (broadcasts.length > 0) { %>
        <div
          class="mt-6 flex flex-col sm:flex-row items-center justify-center gap-4"
        >
          <!-- Pagination Buttons -->
          <div class="flex items-center gap-2">
            <button
              onclick="changeCardPage('prev')"
              class="p-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              id="cardPrevBtn"
            >
              <i class="ti ti-chevron-left"></i>
            </button>

            <div id="cardPaginationNumbers" class="flex items-center gap-2">
              <!-- Page numbers will be generated by JavaScript -->
            </div>

            <button
              onclick="changeCardPage('next')"
              class="p-2 bg-gray-700 hover:bg-gray-600 text-white rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              id="cardNextBtn"
            >
              <i class="ti ti-chevron-right"></i>
            </button>
          </div>

          <!-- Showing Info -->
          <p class="text-sm text-gray-400" id="cardShowingInfo">
            Showing 1-<%= Math.min(broadcasts.length, 10) %> of <%=
            broadcasts.length %> streams
          </p>
        </div>
        <% } %>
      </div>
    </div>
  </main>
</div>

<%- include('streams/modals/new-stream-modal') %> <%-
include('streams/modals/edit-stream-modal') %> <%-
include('streams/modals/stream-info-modal') %>
<script src="/js/dashboard.js"></script>
<script src="/js/broadcast-content-selector.js"></script>
